<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@100&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/pade.css">
    <script src="https://code.jquery.com/jquery-latest.js"></script>

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="http://madalla.kr/js/jquery-1.8.3.min.js"></script>

    <script>
        // SDK를 초기화 합니다. 사용할 앱의 JavaScript 키를 설정해 주세요.
        Kakao.init('241e8e5d885ad576b5c291865fbe3373'); // 사용할 앱의 JavaScript키를 입력해 주세요.
        // SDK 초기화 여부를 판단합니다.
    </script>

    <script>
        $(document).ready(function () {
            $('#naver_id_login').click(function () {
                console.log("클릭")
                $.ajax({
                    url: "/getInfo",
                    type: "post",
                    success: function (data) {
                        location.href = "https://nid.naver.com/oauth2.0/authorize?response_type=code&client_id=" + data.client_id + "&redirect_uri=http://localhost:8080/naverLogin&state=" + data.state;
                    }
                })
            })

            let key;
            getKM()
            function getKM() {
                $.ajax({
                    url: "/getimg",
                    type: "POST",
                    success: function (data) {
                        key=data.key
                        $('#img').attr('src', '/teamImage/' + data.img);
                        // console.log(data.img)
                    }
                })
            }

            $("#login_btn").on('click', function () {
                loginChk();
            })
            function loginChk() {
                $.ajax({
                    url: "/loginUser",
                    type: "POST",
                    data: {
                        id: $("#id").val(),
                        pw: $("#pw").val()
                    },
                    success: function (data) {
                        if (data == "아이디 또는 비밀번호가 일치하지 않습니다.") {
                            // $("#check").html(data);
                            // $("#check").attr('color', 'red');
                            history.go(0);
                        } else {
                            $.ajax({
                                url: "/getCheck",
                                type: "POST",
                                data: {data: $('#txt').val(), key: key},
                                success: function (data) {
                                    console.log(data)
                                    if (data == "true") {
                                        // console.log("맞음")
                                        window.location.href = "/";
                                    } else {
                                        // console.log("다름")
                                        alert("자동입력 방지문자가 틀립니다.")
                                        $('#txt').val("")
                                        getKM();
                                    }
                                }
                            })
                        }
                    },
                });
            }




        })
    </script>


</head>
<body>
<div class="container" style="margin-top: 20px;">
    <div class="row">


        <div class="col-4"></div>
        <div class="col-4">
            <div style="text-align: center; margin-top: 50px;  margin-bottom: 50px;">
                <img src="../images/headerimage.png" width="100%" alt="사진 없음">
            </div>
            <div>
                <input type="text" id="id" class="form-control"
                       placeholder="ID" style="margin-top: 10px;">
                <input type="password" id="pw" class="form-control"
                       placeholder="PW" style="margin-top: 10px;">
                <font id="check" size="2"> </font>

                <span>아래 이미지를 보이는 대로 입력해주세요.</span><br/>
                <img id="img" width="300">
                <input type="text" id="txt"/>

                <div class="col-12" style="margin-top: 10px;">
                    <button class="btn btn-outline-secondary" id="login_btn" type="submit" style="width: 100%;"> 로그인
                    </button>
                </div>
            </div>

            <div class="hr-sect" style="margin-top: 50px; margin-bottom: 50px; ">또는</div>
            <div style="margin-left: 80px; margin-bottom: 70px; ">
                <a href="https://kauth.kakao.com/oauth/authorize?client_id=4d6bfc510b9480c47be3a30e3ae11deb&redirect_uri=http://localhost:8080/kakaoLogin&response_type=code"
                   style="text-decoration:none; text-align-all: center;">
                    <img src="../images/kakaologo.png" alt=""
                         style="width: 23px; height: 23px; float: left; margin-right: 10px; ">
                    <h5 style=" text-decoration: none; color: #595858;"> 카카오계정으로 로그인</h5>
                </a>
            </div>
            <div>
                <button id="naver_id_login">네이버!!!!!!!!!</button>
            </div>

            <div class="row">
                <div class="py-1 text-center">
                    <a class="btn btn-lg btn-light" href="/signUp">회원가입</a>
                    <a class="btn btn-lg btn-light" href="/findID">ID 찾기</a>
                    <a class="btn btn-lg btn-light" href="/findPW">PW 찾기</a>
                </div>
            </div>
        </div>
    </div>


</div>


</body>
</html>