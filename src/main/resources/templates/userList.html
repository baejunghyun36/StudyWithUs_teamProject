<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Study With Us</title>
    <!-- Required meta tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-
  to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.js"></script>

    <link rel="stylesheet" href="../css/style.css" />
    <script>
        $.ajax({
            url: "/checkUser",
            type: "POST",
            success: function (data) {
                console.log('성공')
                console.log(data)
                if (data == 0) {
                    $('#logoutbtn').attr("hidden",true);
                } else {
                    $('#loginbtn').attr("hidden",true);
                }
            }, error: function (error) {
                console.log(error);
            }
        });
    </script>
</head>
<body>
<div class="header">
    <div class="container flex" style="margin-top: 10px">
        <div class="logo">
            <a href="/">
                <img src="../images/logo.png" />
            </a>
        </div>
        <div class="row">
            <ul>
                <li>
                    <a href="/adminPage"><h6>관리자페이지</h6></a>
                </li>
                <li  id="loginbtn">
                    <a href="/login"><h6>로그인</h6></a>
                </li>
                <li  id="logoutbtn">
                    <a href="/logout"><h6>로그아웃</h6></a>
                </li>
                <li>
                    <a href="/myPage" ><h6>마이페이지</h6></a>
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="container admin">
    <h4 style="text-align: center; color: #386ad1; margin: 50px auto 5px auto;">ADMIN PAGE</h4>
    <div class="flex" style="width: 35%; margin: 10px auto;">
        <h5><a href="/adminPage" style="margin: 10px">환급 리스트</a></h5>
        <h5><a href="/userList" style="margin: 10px">사용자 리스트</a></h5>
        <h5><a href="/teamList" style="margin: 10px">스터디 리스트</a></h5>
    </div>
</div>

<div class="container admin" style="margin-top: 80px;">
    <h1 style="text-align: center;">사용자 리스트</h1>

    <div style="text-align: right; margin-right: 10px; margin-top: 30px; ">
        <input type="text" id="userID" placeholder="사용자 아이디를 입력하세요" style="width: 200px; padding: 10px">
        <button id ="search">검색</button>
        <button id ="reset" type="reset">취소</button>
    </div>

    <table class="table table-hover" style="margin-top: 30px; text-align: center;">
        <thead class="thead-dark">
            <tr>
                <th scope="col">번호</th>
                <th scope="col">이름</th>
                <th scope="col">아이디</th>
                <th scope="col">비밀번호</th>
                <th scope="col">포인트</th>
                <th scope="col">삭제여부</th>
            </tr>
        </thead>
        <tbody id="users"></tbody>
    </table>

</div>

<script>
    getUserInfo();
    function getUserInfo(){
        let check1 =0;
        let userID1 = "";
        $("#search").on('click', function() {
            check1 = 1;
            userID1 = $("#userID").val();
            $('#users').empty();
            getUser();
        })
        $("#reset").on('click', function() {
            check1 = 0;
            userID1 ="";
            $('#users').empty();
            getUser();
        })
        if(check1==0)getUser();
        function getUser(){
            $.ajax({
                type:"get",
                url:"/userListInfo",
                data: {
                    check : check1,
                    userID: userID1
                },
                success: function(data){
                    let accounts = document.getElementById('users');
                    data.forEach(function(user){

                        let uid = document.createElement('td');
                        uid.setAttribute("scope", "row");
                        uid.innerHTML = user.uuID;

                        let name = document.createElement('td');
                        name.innerHTML = user.userName;

                        let id = document.createElement('td');
                        id.innerHTML = user.userID;


                        let pw = document.createElement('td');
                        pw.innerHTML = user.pw;


                        let point = document.createElement('td');
                        point.innerHTML = user.point


                        let check = document.createElement('td');

                        let deleteButton = document.createElement('button');

                        deleteButton.innerText = "회원 삭제";
                        deleteButton.setAttribute("type", "button")
                        deleteButton.setAttribute("class", "btn btn-danger btn-sm")

                        check.appendChild(deleteButton);

                        let eachAccount = document.createElement('tr');
                        eachAccount.setAttribute("style", "text-align:center;")
                        eachAccount.append(uid);
                        eachAccount.append(name);
                        eachAccount.append(id)
                        eachAccount.append(pw);
                        eachAccount.append(point);
                        eachAccount.append(check);

                        accounts.appendChild(eachAccount);
                        deleteButton.addEventListener("click", ()=>{
                            $.ajax({
                                url: "/deleteUser",
                                type: "GET",
                                dataType:"json",
                                data: {
                                    uID : user.uuID
                                },
                                success: function (data){
                                    alert("회원이 삭제되었습니다.")
                                    window.location.replace('/userList');

                                }, error:function(){
                                    alert("관리자가 아닙니다.");
                                    window.location.replace('/userList') ;
                                }
                            });
                        });

                    });
                }, error:function(){
                    alert("error");
                }
            })
        }

    }
</script>



</body>
</html>